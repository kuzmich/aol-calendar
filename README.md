# Календарь курсов и мероприятий ИЖ в Иркутске
Влючает курсы, поддерживающие занятия, мероприятия в офисе, другие мероприятия типа «Дня
Йоги» и пр.

## Общая логика работы
Первое наполнение событиями произошло из курсов админки. События из админки парсились и
сохранялись в дата-файлы JSON для ускорения доступа. Это делал скрипт `make_calendar.py`.
Затем появилась форма для ручного ввода событий. Но так как сохранять ручной ввод в
дата-файлах было не удобно, появилось решение перенести все события в базу MongoDB. Это
делал скрипт `copy_data_files_to_mongodb.py`.

Параллельно статическому генератору (`make_calendar.py`) появился обычный сайт на Flask
(`app.py`), который генерировался на лету после каждого добавления/редактирования события. 

При генерации календаря события из базы дополняются нужной информацией, разбиваются на
блоки по неделям, дополняются уровнем (если событий в один день несколько, они размещаются
на нескольких уровнях, одно под другим)) и затем отдаются в шаблон.

Для визуализации календаря используется CSS Grid. Блок события позиционируется с помощью
`grid-row` и `grid-column`. Если событий в одной дате несколько, они размещаются друг под
другом с помощью `margin`.

## Запуск сайта и статического генератора
Сайт запускается комндой `uv run flask --app aol_calendar run --debug`.  Статический
генератор (`uv run scripts/make_calendar.py`) делает html файлы в папке `out`
(`out/2025.html`, `out/2026.html`). Статические страницы публикуются в интернете с помощью
обычного `git push` - Github Action берет файлы из папки `out` и публикует их в Github
Pages.

## TODO
- Уменьшить контрастность заголовков месяца <h2>. Добавить контрастности тексту ART Excel
  (сильно бледный сейчас).
- Помечать текущую дату
- Проверить, что отображаются события, которые начались в одном месяце, а заканчиваются в другом.
- Сортировать события по дню начала и **времени**
- Помечать конец/начало полоски, если событие не закончилось неделей/началось не на этой неделе:
```
/* стрелка вправо справа */
clip-path: polygon(0% 0%, calc(100% - 10px) 0%, 100% 50%, calc(100% - 10px) 100%, 0% 100%);
padding-right: 10px;

/* стрелка влево слева */
clip-path: polygon(0% 50%, 10px 0%, 100% 0%, 100% 100%, 10px 100%);
padding-left: 10px;
/ * стрелка вправо слева */
clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 10px 50%);
```
## TODO внутреннее
- Вынести преобразование формата из базы в формат формы в отдельную функцию (`get_event_form`)
- Рендерить ошибки в форме события
- В кнопке добавления + сделать svg
- Помечать как-то онлайн события (градиентом например)
- Сделать админку, в которой вести список учителей, мест и событий. Т.е. перенести их из
  файлов `teachers.json`, `locations.json`, `events.json` в базу.

## TODO публичное
- Сделать фильтр курсов плавающей строкой вверху (горизонтальный скролл и overflow)

## Идеи на будущее
- Разбить события в календаре на несколько табов, чтобы видеть не все вместе, а только часть
  курсов, например группа базовых курсов (Первый шаг, Счастье, Глубокий сон), регулярные
  занятия (Поддерживающие занятия, йога), следующие шаги (Медитация, Продолженный),
  дополнительные курсы (Кулинария, )
- Таблица с курсами: сортировать по наименованиям курсов (за год). К примеру человек выбирает
  Счастье и ему открывается табличка с датами, местом проведения, учителями и
  ссылочками. "Выходят" ввиде таблички за весь год.
